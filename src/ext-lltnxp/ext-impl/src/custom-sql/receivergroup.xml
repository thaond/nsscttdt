<?xml version="1.0" encoding="UTF-8"?>

<custom-sql>
	<sql id="com.sgs.portlet.receivergroup.service.persistence.ReceiverFinder.findUsersByFullname_ScreenName">
		<![CDATA[
			SELECT
				DISTINCT User_.*, Contact_.firstName, Contact_.middleName, Contact_.lastName, pml_departments.departmentsname
			FROM
				User_
			INNER JOIN
				Contact_ ON
					(Contact_.contactId = User_.contactId)
			INNER JOIN
				pml_user ON
					(User_.userid = pml_user.userid)
			INNER JOIN
				pml_departments ON
					(pml_user.departmentsid = pml_departments.departmentsid)
			WHERE
				(User_.companyId = ?) AND
				(User_.defaultUser = ?) AND
				(
					((lower(Contact_.lastname || ' ' || Contact_.middlename || ' ' || Contact_.firstname)) LIKE ? [$AND_OR_NULL_CHECK$]) [$AND_OR_CONNECTOR$]
					(lower(User_.screenName) LIKE ? [$AND_OR_NULL_CHECK$]) [$AND_OR_CONNECTOR$]
					(lower(pml_departments.departmentsname) LIKE ? [$AND_OR_NULL_CHECK$])
				) AND (User_.active_ = ?) 
				AND (User_.userid IN (SELECT userid FROM pml_departmentleader))
			ORDER BY
				Contact_.firstName ASC,
				Contact_.middleName ASC,
				Contact_.lastName ASC
		]]>
	</sql>
</custom-sql>